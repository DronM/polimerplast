-- View: client_list--DROP VIEW client_list;CREATE OR REPLACE VIEW client_list AS 	SELECT 			cl.id,			cl.name,			cl.client_activity_id,			cl_a.name AS client_activity_descr,			cl.inn,			get_contract_states_descr(cl_c.state) AS contract_descr,			date10_descr(cl_c.date_to) contract_period,			CASE				WHEN cl.pay_type='with_delay'::payment_types THEN					get_payment_types_descr(cl.pay_type)::text||'('||cl.pay_delay_days||'дн.)'				ELSE					get_payment_types_descr(cl.pay_type)::text			END AS terms,			0 AS debt,			cl.login_allowed		FROM clients AS cl	LEFT JOIN client_activities AS cl_a ON cl_a.id=cl.client_activity_id	LEFT JOIN client_contracts AS cl_c		ON cl_c.client_id=cl.id		AND cl_c.date_to=(			SELECT MAX(sub.date_to)			FROM client_contracts AS sub			WHERE sub.client_id=cl.id			)	WHERE cl.registered;ALTER TABLE client_list OWNER TO polimerplast;